{"ast":null,"code":"import axios, { AxiosError } from \"axios\";\nimport { atom, selector, selectorFamily } from \"recoil\";\nimport { recoilPersist } from \"recoil-persist\";\nconst {\n  persistAtom\n} = recoilPersist();\n\n// kakao API 호출\nconst KAKAO_API_KEY = process.env.REACT_APP_KAKAO_API_KEY;\n\n// 검색한 결과값\nexport const bookDataState = atom({\n  key: \"bookDataState\",\n  default: []\n});\n\n// 입력한 검색어\nexport const searchInfoState = atom({\n  key: \"searchInfoState\",\n  default: \"\"\n});\n\n// 상세보기 책\nexport const bookDetailState = atom({\n  key: \"bookDetailState\",\n  default: [],\n  effects_UNSTABLE: [persistAtom]\n});\n\n// 북마크한 책\nexport const bookmarkState = atom({\n  key: \"bookmark\",\n  default: [],\n  effects_UNSTABLE: [persistAtom]\n});\n\n// 검색 api 호출\nexport const bookDataSelectorFamily = selectorFamily({\n  key: \"bookDataSelectorFamily\",\n  get: search => async ({\n    get\n  }) => {\n    // API 호출\n    try {\n      const res = await axios({\n        method: \"get\",\n        baseURL: \"https://dapi.kakao.com/v3/search/book\",\n        headers: {\n          Authorization: \"KakaoAK \" + KAKAO_API_KEY\n        },\n        params: {\n          query: search,\n          size: 50,\n          target: [\"title\", \"person\"]\n        }\n      });\n      return res.data.documents;\n    } catch (error) {\n      if (error instanceof AxiosError) {\n        var _error$response;\n        if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 400) {\n          console.log(error);\n        }\n      }\n    }\n  }\n});\n\n//검색을 하고 눌르면 watch 추가\n// 그럼 추가된 아이템을 detail 담아두고 나중에 또 검색했을 때, watch 가 있으면? 그냥 냅두기\n// 없으면? detail 에 추가\n\n// 검색한 책 중 눌러본 책 필터링 후 watch 속성 추가\nexport const detailBookSelector = selector({\n  key: \"detailBookSelector\",\n  get: ({\n    get\n  }) => {\n    const bookState = get(bookDetailState);\n    const findItem = bookState.find(item => item.watch);\n    console.log(findItem);\n    return findItem;\n  },\n  set: ({\n    set,\n    get\n  }, newValue) => {\n    const bookState = get(bookDetailState);\n    const updatedData = bookState.map(item => {\n      if (item === newValue) {\n        return {\n          ...item,\n          watch: true\n        };\n      }\n      return {\n        ...item,\n        watch: false\n      };\n    });\n    set(bookDataState, updatedData);\n  }\n});\n\n// 검색한 책 중 눌러본 책 필터링 후 북마크 속성 추가\nexport const bookMarkSelector = selector({\n  key: \"bookMarkSelector\",\n  get: ({\n    get\n  }) => {\n    const bookState = get(bookDataState);\n    const findItem = bookState.find(item => item.isMarked === true);\n    return findItem;\n  },\n  set: ({\n    set,\n    get\n  }, newValue) => {\n    const bookState = get(bookDataState);\n    const updatedData = bookState.map(item => {\n      if (item === newValue) {\n        return {\n          ...item,\n          isMarked: true\n        };\n      }\n      return {\n        ...item,\n        isMarked: false\n      };\n    });\n    set(bookDataState, updatedData);\n  }\n});\n\n// watch true 로 바꾸는 기능\nexport const filteredBookSelector = selectorFamily({\n  key: \"filteredBookSelector\",\n  get: bookCode => ({\n    get\n  }) => {\n    const detailState = get(bookDetailState);\n    const findItem = detailState === null || detailState === void 0 ? void 0 : detailState.find(item => {\n      return item.isbn.split(\" \").join(\"\") === bookCode;\n    });\n    return findItem === null || findItem === void 0 ? void 0 : findItem.watch;\n  },\n  set: bookCode => ({\n    set,\n    get\n  }, newValue) => {\n    const detailState = get(bookDetailState);\n    const updatedData = detailState === null || detailState === void 0 ? void 0 : detailState.map(item => {\n      if (item.isbn.split(\" \").join(\"\") == bookCode) {\n        return {\n          ...item,\n          watch: newValue\n        };\n      }\n      return item;\n    });\n    set(bookDataState, updatedData);\n  }\n});","map":{"version":3,"names":["axios","AxiosError","atom","selector","selectorFamily","recoilPersist","persistAtom","KAKAO_API_KEY","process","env","REACT_APP_KAKAO_API_KEY","bookDataState","key","default","searchInfoState","bookDetailState","effects_UNSTABLE","bookmarkState","bookDataSelectorFamily","get","search","res","method","baseURL","headers","Authorization","params","query","size","target","data","documents","error","_error$response","response","status","console","log","detailBookSelector","bookState","findItem","find","item","watch","set","newValue","updatedData","map","bookMarkSelector","isMarked","filteredBookSelector","bookCode","detailState","isbn","split","join"],"sources":["/Users/zoe/Documents/Wishread/src/recoil/books.ts"],"sourcesContent":["import axios, { AxiosError } from \"axios\";\nimport { BookDTO } from \"components/types/searchType\";\nimport { atom, selector, selectorFamily } from \"recoil\";\nimport { recoilPersist } from \"recoil-persist\";\n\nconst { persistAtom } = recoilPersist();\n\n// kakao API 호출\nconst KAKAO_API_KEY = process.env.REACT_APP_KAKAO_API_KEY;\n\n// 검색한 결과값\nexport const bookDataState = atom<BookDTO[]>({\n  key: \"bookDataState\",\n  default: [],\n});\n\n// 입력한 검색어\nexport const searchInfoState = atom({\n  key: \"searchInfoState\",\n  default: \"\",\n});\n\n// 상세보기 책\nexport const bookDetailState = atom({\n  key: \"bookDetailState\",\n  default: [],\n  effects_UNSTABLE: [persistAtom],\n});\n\n// 북마크한 책\nexport const bookmarkState = atom({\n  key: \"bookmark\",\n  default: [],\n  effects_UNSTABLE: [persistAtom],\n});\n\n// 검색 api 호출\nexport const bookDataSelectorFamily = selectorFamily({\n  key: \"bookDataSelectorFamily\",\n  get:\n    (search) =>\n    async ({ get }) => {\n      // API 호출\n      try {\n        const res = await axios({\n          method: \"get\",\n          baseURL: \"https://dapi.kakao.com/v3/search/book\",\n          headers: {\n            Authorization: \"KakaoAK \" + KAKAO_API_KEY,\n          },\n          params: {\n            query: search,\n            size: 50,\n            target: [\"title\", \"person\"],\n          },\n        });\n        return res.data.documents;\n      } catch (error) {\n        if (error instanceof AxiosError) {\n          if (error.response?.status === 400) {\n            console.log(error);\n          }\n        }\n      }\n    },\n});\n\n//검색을 하고 눌르면 watch 추가\n// 그럼 추가된 아이템을 detail 담아두고 나중에 또 검색했을 때, watch 가 있으면? 그냥 냅두기\n// 없으면? detail 에 추가\n\n// 검색한 책 중 눌러본 책 필터링 후 watch 속성 추가\nexport const detailBookSelector = selector({\n  key: \"detailBookSelector\",\n  get: ({ get }) => {\n    const bookState = get(bookDetailState);\n    const findItem = bookState.find((item) => item.watch);\n    console.log(findItem);\n    return findItem;\n  },\n  set: ({ set, get }, newValue) => {\n    const bookState = get(bookDetailState);\n    const updatedData = bookState.map((item) => {\n      if (item === newValue) {\n        return { ...item, watch: true };\n      }\n      return { ...item, watch: false };\n    });\n    set(bookDataState, updatedData);\n  },\n});\n\n// 검색한 책 중 눌러본 책 필터링 후 북마크 속성 추가\nexport const bookMarkSelector = selector({\n  key: \"bookMarkSelector\",\n  get: ({ get }) => {\n    const bookState = get(bookDataState);\n    const findItem = bookState.find((item) => item.isMarked === true);\n    return findItem;\n  },\n  set: ({ set, get }, newValue) => {\n    const bookState = get(bookDataState);\n    const updatedData = bookState.map((item) => {\n      if (item === newValue) {\n        return { ...item, isMarked: true };\n      }\n      return { ...item, isMarked: false };\n    });\n    set(bookDataState, updatedData);\n  },\n});\n\n// watch true 로 바꾸는 기능\nexport const filteredBookSelector = selectorFamily<boolean | undefined, string>(\n  {\n    key: \"filteredBookSelector\",\n    get:\n      (bookCode) =>\n      ({ get }) => {\n        const detailState = get(bookDetailState);\n        const findItem = detailState?.find((item: BookDTO) => {\n          return item.isbn.split(\" \").join(\"\") === bookCode;\n        });\n        return findItem?.watch;\n      },\n    set:\n      (bookCode) =>\n      ({ set, get }, newValue) => {\n        const detailState = get(bookDetailState);\n        const updatedData = detailState?.map((item: BookDTO) => {\n          if (item.isbn.split(\" \").join(\"\") == bookCode) {\n            return { ...item, watch: newValue };\n          }\n          return item;\n        });\n\n        set(bookDataState, updatedData);\n      },\n  }\n);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}