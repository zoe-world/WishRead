{"ast":null,"code":"import axios,{AxiosError}from\"axios\";import{atom,selectorFamily}from\"recoil\";import{recoilPersist}from\"recoil-persist\";const{persistAtom}=recoilPersist();// kakao API 호출\nconst KAKAO_API_KEY=process.env.REACT_APP_KAKAO_API_KEY;// 검색한 결과값\nexport const bookDataState=atom({key:\"bookDataState\",default:[]});// 입력한 검색어\nexport const searchInfoState=atom({key:\"searchInfoState\",default:\"\"});// 상세보기 책\nexport const bookDetailState=atom({key:\"bookDetailState\",default:[],effects_UNSTABLE:[persistAtom]});// 검색 api 호출\nexport const bookDataSelectorFamily=selectorFamily({key:\"bookDataSelectorFamily\",get:search=>async _ref=>{let{get}=_ref;// API 호출\ntry{const res=await axios({method:\"get\",baseURL:\"https://dapi.kakao.com/v3/search/book\",headers:{Authorization:\"KakaoAK \"+KAKAO_API_KEY},params:{query:search,size:50,target:[\"title\",\"person\"]}});return res.data.documents;}catch(error){if(error instanceof AxiosError){var _error$response;if(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===400){console.log(error);}}}}});//검색을 하고 눌르면 watch 추가\n// 그럼 추가된 아이템을 detail 담아두고 나중에 또 검색했을 때, watch 가 있으면? 그냥 냅두기\n// 없으면? detail 에 추가\n// 검색한 책 중 눌러본 책 필터링 후 watch 속성 추가\nexport const detailBookSelector=selectorFamily({key:\"detailBookSelector\",get:barcode=>_ref2=>{let{get}=_ref2;const bookState=get(bookDataState);const findItem=bookState.find(item=>item.isbn.split(\" \").join(\"\")===barcode&&item.watch===true);return findItem;},set:barcode=>(_ref3,newValue)=>{let{set,get}=_ref3;const bookState=get(bookDataState);const updatedData=bookState.map(item=>{if(item===newValue){return{...item,watch:true,isMarked:false};}return{...item,watch:false,isMarked:false};});set(bookDataState,updatedData);}});","map":{"version":3,"names":["axios","AxiosError","atom","selectorFamily","recoilPersist","persistAtom","KAKAO_API_KEY","process","env","REACT_APP_KAKAO_API_KEY","bookDataState","key","default","searchInfoState","bookDetailState","effects_UNSTABLE","bookDataSelectorFamily","get","search","_ref","res","method","baseURL","headers","Authorization","params","query","size","target","data","documents","error","_error$response","response","status","console","log","detailBookSelector","barcode","_ref2","bookState","findItem","find","item","isbn","split","join","watch","set","_ref3","newValue","updatedData","map","isMarked"],"sources":["/Users/zoe/Documents/Wishread/src/recoil/books.ts"],"sourcesContent":["import axios, { AxiosError } from \"axios\";\nimport { BookDTO } from \"components/types/searchType\";\nimport { atom, selector, selectorFamily } from \"recoil\";\nimport { recoilPersist } from \"recoil-persist\";\n\nconst { persistAtom } = recoilPersist();\n\n// kakao API 호출\nconst KAKAO_API_KEY = process.env.REACT_APP_KAKAO_API_KEY;\n\n// 검색한 결과값\nexport const bookDataState = atom<BookDTO[]>({\n  key: \"bookDataState\",\n  default: [],\n});\n\n// 입력한 검색어\nexport const searchInfoState = atom({\n  key: \"searchInfoState\",\n  default: \"\",\n});\n\n// 상세보기 책\nexport const bookDetailState = atom({\n  key: \"bookDetailState\",\n  default: [],\n  effects_UNSTABLE: [persistAtom],\n});\n\n// 검색 api 호출\nexport const bookDataSelectorFamily = selectorFamily({\n  key: \"bookDataSelectorFamily\",\n  get:\n    (search) =>\n    async ({ get }) => {\n      // API 호출\n      try {\n        const res = await axios({\n          method: \"get\",\n          baseURL: \"https://dapi.kakao.com/v3/search/book\",\n          headers: {\n            Authorization: \"KakaoAK \" + KAKAO_API_KEY,\n          },\n          params: {\n            query: search,\n            size: 50,\n            target: [\"title\", \"person\"],\n          },\n        });\n        return res.data.documents;\n      } catch (error) {\n        if (error instanceof AxiosError) {\n          if (error.response?.status === 400) {\n            console.log(error);\n          }\n        }\n      }\n    },\n});\n\n//검색을 하고 눌르면 watch 추가\n// 그럼 추가된 아이템을 detail 담아두고 나중에 또 검색했을 때, watch 가 있으면? 그냥 냅두기\n// 없으면? detail 에 추가\n\n// 검색한 책 중 눌러본 책 필터링 후 watch 속성 추가\nexport const detailBookSelector = selectorFamily({\n  key: \"detailBookSelector\",\n  get:\n    (barcode) =>\n    ({ get }) => {\n      const bookState = get(bookDataState);\n      const findItem = bookState.find(\n        (item: any) =>\n          item.isbn.split(\" \").join(\"\") === barcode && item.watch === true\n      );\n      return findItem;\n    },\n  set:\n    (barcode) =>\n    ({ set, get }, newValue) => {\n      const bookState = get(bookDataState);\n      const updatedData = bookState.map((item: any) => {\n        if (item === newValue) {\n          return { ...item, watch: true, isMarked: false };\n        }\n        return { ...item, watch: false, isMarked: false };\n      });\n      set(bookDataState, updatedData);\n    },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}